"use strict";console.log(">> Ready :)");const inputText=document.querySelector(".js__inputText"),btn=document.querySelector(".js__searchBtn"),favContainer=document.querySelector(".js__fav"),resultsContainer=document.querySelector(".js__results"),resetBtn=document.querySelector(".reset__btn");let resultList=[],favs=[],favsarray=JSON.parse(localStorage.getItem("favoriteShowsArray"));function init(){writeFav()}function createNewElement(e,t,a,n){const s=document.createElement(e);s.classList.add(t),s.setAttribute("data-id",a);const o=document.createElement("h3");o.classList.add("showTitle");const i=document.createTextNode(n);return o.appendChild(i),s.appendChild(o),s}function createNewDiv(e,t,a){const n=document.createElement(e);return n.classList.add(t),n.setAttribute("data-id",a),n}function createNewTitle(e,t,a){const n=document.createElement(e);n.classList.add(t);const s=document.createTextNode(a);return n.appendChild(s),n}function createNewImage(e,t,a,n){const s=document.createElement(e);return s.src=a,s.alt=n,s.classList.add(t),s}function writeFav(){favContainer.innerHTML="";let e=JSON.parse(localStorage.getItem("favoriteShowsArray"));if(null!==e)for(const t of e){const e=createNewDiv("div","fav_TitleWrapper",t.id),a=createNewTitle("h3","fav__ShowTitle",t.name),n=document.createElement("button");n.classList.add("closeBtn"),n.addEventListener("click",remove),e.appendChild(a),e.appendChild(n);const s=createNewImage("img","favImg",t.img,t.name),o=createNewDiv("div","favShow",t.id);o.appendChild(e),o.appendChild(s),favContainer.appendChild(o)}}function addFavs(e){const t=e.currentTarget,a=t.getAttribute("data-id"),n=t.querySelector(".img").src,s=t.querySelector(".showTitle").innerHTML,o={id:a,name:s,img:n};if(t.classList.toggle("show__fav"),null!==favs&&0!==favs.length){let e=favs.find(e=>e.id===a);if(void 0===e)favs.push(o);else{const t=favs.indexOf(e);t>-1&&favs.splice(t,1)}}else(favs=[]).push(o);saveToLocalStorage(),writeFav()}function saveToLocalStorage(){localStorage.setItem("favoriteShowsArray",JSON.stringify(favs))}function remove(e){const t=e.currentTarget.parentElement.parentElement.getAttribute("data-id");let a=favs.find(e=>e.id===t);const n=favs.indexOf(a);n>-1&&favs.splice(n,1),saveToLocalStorage(),writeFav()}function cleanAll(){favs=[],localStorage.clear(),writeFav();const e=document.querySelectorAll(".show__fav");for(const t of e)t.classList.toggle("show__fav")}function search(){const e=inputText.value;fetch(`http://api.tvmaze.com/search/shows?q=${e}`).then(e=>e.json()).then(e=>{resultsContainer.innerHTML="",resultList=[];for(const t of e){const e=createNewElement("div","show",`${t.show.id}`,t.show.name);if(null!==t.show.image){const a=createNewImage("img","img",t.show.image.medium,t.show.title);e.appendChild(a)}else{const a=createNewImage("img","img","https://via.placeholder.com/210x295/ffffff/666666/?text=TV",t.show.title);e.appendChild(a)}resultList.push(e)}for(const e of resultList){const t=e.getAttribute("data-id");if(null!==favs&&0!==favs.length){void 0!==favs.find(e=>e.id===t)&&e.classList.toggle("show__fav")}resultsContainer.appendChild(e)}const t=document.querySelectorAll(".show");for(const e of t)e.addEventListener("click",addFavs)})}function fakeClick(e){13===e.keyCode&&search()}null!==favsarray&&(favs=favsarray),inputText.addEventListener("keyup",fakeClick),resetBtn.addEventListener("click",cleanAll),btn.addEventListener("click",search),init();